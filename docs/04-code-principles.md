# Project Organization & Coding Principles

These are the lab's standards for organizing research projects. Following them makes your code readable, reproducible, and Claude-friendly.

## Folder Structure

Every project should have this basic structure:

```
project/
├── code/           # All scripts — nothing else
├── output/         # Results: figures, tables, logs
├── temp/           # Temporary/intermediate files (GITIGNORED)
├── README.md       # What this project does and how to run it
├── CLAUDE.md       # Claude Code context (see Workflow section)
└── .gitignore      # Must ignore temp/ and large data files
```

The `temp/` folder is for intermediate datasets, scratch files, and anything that can be regenerated by running the code. It must always be in `.gitignore` — never commit temporary files.

Your `.gitignore` should include at minimum:

```
temp/
*.dta
*.csv
*.log
.DS_Store
```

## Number Your Scripts

Prefix every script with a number indicating its order in the pipeline:

```
code/
├── 1_clean_raw_data.do
├── 2_merge_datasets.do
├── 3_run_regressions.do
├── 4_make_tables.do
└── 5_make_figures.py
```

This makes the execution order immediately obvious to anyone reading the project — including Claude. When someone opens the folder, they can see at a glance what runs first, second, third.

For sub-steps, use decimals or underscores: `1a_clean_trade.do`, `1b_clean_firms.do`.

## Use Subfolders Liberally

As projects grow, organize code and output into subfolders that mirror each other:

```
code/
├── cleaning/
│   ├── 1_clean_trade.do
│   └── 2_clean_firms.do
├── analysis/
│   ├── 1_main_regressions.do
│   └── 2_robustness.do
└── figures/
    ├── 1_main_results.py
    └── 2_mechanisms.py

output/
├── cleaning/
│   └── summary_stats.log
├── analysis/
│   ├── table1_main.tex
│   └── table2_robust.tex
└── figures/
    ├── fig1_main.pdf
    └── fig2_mechanisms.pdf
```

The parallel structure between `code/` and `output/` makes it trivial to find which script produced which output.

## Functional Programming

Write functions, not monolithic scripts. Every script should be a collection of well-named functions that each do one thing.

**Bad** — a 500-line script that loads data, cleans it, runs regressions, and makes tables all in one go.

**Good** — a main script that calls discrete functions:

```python
# 3_run_regressions.py

def load_analysis_data(path):
    """Load the cleaned analysis dataset."""
    ...

def run_main_specification(df):
    """Run the baseline OLS regression (Table 1, Column 1)."""
    ...

def run_iv_specification(df, instrument):
    """Run the IV regression (Table 1, Column 3)."""
    ...

if __name__ == "__main__":
    df = load_analysis_data("output/cleaning/analysis_sample.parquet")
    ols_results = run_main_specification(df)
    iv_results = run_iv_specification(df, instrument="bartik_shock")
    export_table(ols_results, iv_results, path="output/analysis/table1.tex")
```

This approach is better for three reasons: each function can be tested independently, Claude can understand and modify individual functions without breaking others, and you can reuse functions across scripts.

The same principle applies in Stata — use programs and ado files rather than one continuous script.

## Version Control

- Commit early, commit often. Every meaningful change should be a commit.
- Write descriptive commit messages: *"Add IV regression with Bartik instrument"* not *"update code"*.
- Never commit data files, temporary outputs, or credentials.
- Keep `README.md` up to date — it should describe how to run the full pipeline from scratch.

## Additional Principles

**Relative paths only.** Never hardcode absolute paths like `/Users/nick/Dropbox/...`. Use paths relative to the project root. This ensures the project runs on any machine.

**One master script.** Every project should have a single script (e.g., `run_all.do` or `Makefile`) that executes the entire pipeline from raw data to final output. If someone can't reproduce your results by running one command, the project isn't properly organized.

**Separate data from code.** Raw data should live in a `data/` folder (or be downloaded by a script). Never modify raw data files — treat them as read-only. All transformations happen in code and output to `temp/` or `output/`.

**Comment the why, not the what.** Don't write `# add 1 to x` — write `# adjust for zero-indexing in the census year variable`. Claude can read what the code does; it needs to know *why* you're doing it.
